{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Activity",
  "type": "object",
  "required": ["activity_id", "user", "action", "timestamp"],
  "properties": {
    "activity_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique activity identifier"
    },
    "user": {
      "$ref": "#/definitions/UserRef"
    },
    "action": {
      "type": "string",
      "enum": ["create", "update", "delete", "view", "login", "logout"],
      "description": "Type of action performed"
    },
    "resource": {
      "type": "string",
      "description": "Resource affected by the action",
      "x-validators": [
        {
          "name": "coerce_to_lowercase",
          "pre": true
        },
        {
          "name": "min_length",
          "params": { "threshold": 3 }
        }
      ]
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the activity",
      "additionalProperties": true
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the activity occurred"
    },
    "ip_address": {
      "type": "string",
      "description": "IP address of the user",
      "pattern": "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"
    }
  },
  "definitions": {
    "UserRef": {
      "type": "object",
      "required": ["user_id"],
      "properties": {
        "user_id": {
          "type": "integer",
          "x-validators": [
            { "name": "is_positive" }
          ]
        },
        "username": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        }
      }
    }
  }
}
